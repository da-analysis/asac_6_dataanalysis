import streamlit as st
import folium
from streamlit_folium import st_folium
from folium import Popup
import geopandas as gpd
from utils.db_connector import embed_dashboard
from utils.font_loader import load_custom_font
from utils.css_loader import load_css

# Load css
load_css("ui/styles.css")
load_css("ui/map_styles.css")
load_custom_font()

st.header('π—ΊοΈ μ „κµ­ μ§€μ—­ν™”ν λ°ν–‰ ν„ν™©')

# β… GeoJSON λ΅λ“ μµμ ν™”
@st.cache_data
def load_geojson(file_path):
    return gpd.read_file(file_path)

geojson_path = 'data/Sigungu_ver20241001.json'
gdf = load_geojson(geojson_path)  # μΊμ‹±λ λ°μ΄ν„° ν™μ©

# νƒ€κ² μ§€μ—­λ…μΉ­
target_names = [
    "μ„μΈνΉλ³„μ‹ μΆ…λ΅κµ¬", "μ„μΈνΉλ³„μ‹ μ¤‘κµ¬", "μ„μΈνΉλ³„μ‹ μ©μ‚°κµ¬", "μ„μΈνΉλ³„μ‹ μ„±λ™κµ¬", "μ„μΈνΉλ³„μ‹ κ΄‘μ§„κµ¬",
    "μ„μΈνΉλ³„μ‹ λ™λ€λ¬Έκµ¬", "μ„μΈνΉλ³„μ‹ μ¤‘λ‘κµ¬", "μ„μΈνΉλ³„μ‹ μ„±λ¶κµ¬", "μ„μΈνΉλ³„μ‹ κ°•λ¶κµ¬", "μ„μΈνΉλ³„μ‹ λ…Έμ›κµ¬",
    "μ„μΈνΉλ³„μ‹ λ„λ΄‰κµ¬", "μ„μΈνΉλ³„μ‹ μ€ν‰κµ¬", "μ„μΈνΉλ³„μ‹ μ„λ€λ¬Έκµ¬", "μ„μΈνΉλ³„μ‹ λ§ν¬κµ¬", "μ„μΈνΉλ³„μ‹ μ–‘μ²κµ¬",
    "μ„μΈνΉλ³„μ‹ κ°•μ„κµ¬", "μ„μΈνΉλ³„μ‹ κµ¬λ΅κµ¬", "μ„μΈνΉλ³„μ‹ κΈμ²κµ¬", "μ„μΈνΉλ³„μ‹ μλ“±ν¬κµ¬", "μ„μΈνΉλ³„μ‹ λ™μ‘κµ¬",
    "μ„μΈνΉλ³„μ‹ κ΄€μ•…κµ¬", "μ„μΈνΉλ³„μ‹ κ°•λ™κµ¬", "μ„μΈνΉλ³„μ‹ μ„μ΄κµ¬", "μ„μΈνΉλ³„μ‹ κ°•λ‚¨κµ¬", "μ„μΈνΉλ³„μ‹ μ†΅νκµ¬",
    "κ²½κΈ°λ„ μμ›μ‹", "κ²½κΈ°λ„ μ©μΈμ‹", "κ²½κΈ°λ„ κ³ μ–‘μ‹", "κ²½κΈ°λ„ ν™”μ„±μ‹", "κ²½κΈ°λ„ μ„±λ‚¨μ‹", "κ²½κΈ°λ„ λ¶€μ²μ‹",
    "κ²½κΈ°λ„ λ‚¨μ–‘μ£Όμ‹", "κ²½κΈ°λ„ μ•μ‚°μ‹", "κ²½κΈ°λ„ ν‰νƒμ‹", "κ²½κΈ°λ„ μ•μ–‘μ‹", "κ²½κΈ°λ„ μ‹ν¥μ‹", "κ²½κΈ°λ„ νμ£Όμ‹",
    "κ²½κΈ°λ„ κΉ€ν¬μ‹", "κ²½κΈ°λ„ μμ •λ¶€μ‹", "κ²½κΈ°λ„ κ΄‘μ£Όμ‹", "κ²½κΈ°λ„ ν•λ‚¨μ‹", "κ²½κΈ°λ„ κ΄‘λ…μ‹", "κ²½κΈ°λ„ κµ°ν¬μ‹",
    "κ²½κΈ°λ„ μ–‘μ£Όμ‹", "κ²½κΈ°λ„ μ¤μ‚°μ‹", "κ²½κΈ°λ„ μ΄μ²μ‹", "κ²½κΈ°λ„ μ•μ„±μ‹", "κ²½κΈ°λ„ κµ¬λ¦¬μ‹", "κ²½κΈ°λ„ μμ™•μ‹",
    "κ²½κΈ°λ„ ν¬μ²μ‹", "κ²½κΈ°λ„ μ–‘ν‰κµ°", "κ²½κΈ°λ„ μ—¬μ£Όμ‹", "κ²½κΈ°λ„ λ™λ‘μ²μ‹", "κ²½κΈ°λ„ κ³Όμ²μ‹", "κ²½κΈ°λ„ κ°€ν‰κµ°",
    "κ²½κΈ°λ„ μ—°μ²κµ°", "μΈμ²κ΄‘μ—­μ‹ λ™κµ¬", "μΈμ²κ΄‘μ—­μ‹ λ―Έμ¶”ν™€κµ¬", "μΈμ²κ΄‘μ—­μ‹ μ—°μκµ¬", "μΈμ²κ΄‘μ—­μ‹ λ¶€ν‰κµ¬",
    "μΈμ²κ΄‘μ—­μ‹ κ³„μ–‘κµ¬", "μΈμ²κ΄‘μ—­μ‹ μ„κµ¬", "λ¶€μ‚°κ΄‘μ—­μ‹ λ™κµ¬", "λ¶€μ‚°κ΄‘μ—­μ‹ λ‚¨κµ¬", "λ€κµ¬κ΄‘μ—­μ‹ κµ°μ„κµ°",
    "κ°•μ›νΉλ³„μμΉλ„ μ¶μ²μ‹", "κ°•μ›νΉλ³„μμΉλ„ μ›μ£Όμ‹", "κ°•μ›νΉλ³„μμΉλ„ κ°•λ¦‰μ‹", "κ°•μ›νΉλ³„μμΉλ„ λ™ν•΄μ‹",
    "κ°•μ›νΉλ³„μμΉλ„ νƒλ°±μ‹", "κ°•μ›νΉλ³„μμΉλ„ μ†μ΄μ‹", "κ°•μ›νΉλ³„μμΉλ„ μ‚Όμ²™μ‹", "κ°•μ›νΉλ³„μμΉλ„ ν™μ²κµ°",
    "κ°•μ›νΉλ³„μμΉλ„ ν΅μ„±κµ°", "κ°•μ›νΉλ³„μμΉλ„ μμ›”κµ°", "κ°•μ›νΉλ³„μμΉλ„ μ •μ„ κµ°", "κ°•μ›νΉλ³„μμΉλ„ μ² μ›κµ°",
    "κ°•μ›νΉλ³„μμΉλ„ ν™”μ²κµ°", "κ°•μ›νΉλ³„μμΉλ„ μ–‘κµ¬κµ°", "κ°•μ›νΉλ³„μμΉλ„ μΈμ κµ°", "κ°•μ›νΉλ³„μμΉλ„ κ³ μ„±κµ°",
    "μ¶©μ²­λ¶λ„ μ²­μ£Όμ‹", "μ¶©μ²­λ¶λ„ μ¶©μ£Όμ‹", "μ¶©μ²­λ¶λ„ μ μ²μ‹", "μ¶©μ²­λ¶λ„ λ³΄μ€κµ°", "μ¶©μ²­λ¶λ„ μ¥μ²κµ°",
    "μ¶©μ²­λ¶λ„ μλ™κµ°", "μ¶©μ²­λ¶λ„ μ¦ν‰κµ°", "μ¶©μ²­λ¶λ„ μ§„μ²κµ°", "μ¶©μ²­λ¶λ„ κ΄΄μ‚°κµ°", "μ¶©μ²­λ¶λ„ μμ„±κµ°",
    "μ¶©μ²­λ¶λ„ λ‹¨μ–‘κµ°", "μ¶©μ²­λ‚¨λ„ μ²μ•μ‹", "μ¶©μ²­λ‚¨λ„ κ³µμ£Όμ‹", "μ¶©μ²­λ‚¨λ„ λ³΄λ Ήμ‹", "μ¶©μ²­λ‚¨λ„ μ•„μ‚°μ‹",
    "μ¶©μ²­λ‚¨λ„ μ„μ‚°μ‹", "μ¶©μ²­λ‚¨λ„ λ…Όμ‚°μ‹", "μ¶©μ²­λ‚¨λ„ κ³„λ£΅μ‹", "μ¶©μ²­λ‚¨λ„ λ‹Ήμ§„μ‹", "μ¶©μ²­λ‚¨λ„ κΈμ‚°κµ°",
    "μ¶©μ²­λ‚¨λ„ λ¶€μ—¬κµ°", "μ¶©μ²­λ‚¨λ„ μ„μ²κµ°", "μ¶©μ²­λ‚¨λ„ μ²­μ–‘κµ°", "μ¶©μ²­λ‚¨λ„ ν™μ„±κµ°", "μ¶©μ²­λ‚¨λ„ μμ‚°κµ°",
    "μ¶©μ²­λ‚¨λ„ νƒμ•κµ°", "μ „λ¶νΉλ³„μμΉλ„ μ „μ£Όμ‹", "μ „λ¶νΉλ³„μμΉλ„ κµ°μ‚°μ‹", "μ „λ¶νΉλ³„μμΉλ„ μµμ‚°μ‹", "μ „λ¶νΉλ³„μμΉλ„ μ •μμ‹",
    "μ „λ¶νΉλ³„μμΉλ„ λ‚¨μ›μ‹", "μ „λ¶νΉλ³„μμΉλ„ κΉ€μ μ‹", "μ „λ¶νΉλ³„μμΉλ„ μ™„μ£Όκµ°", "μ „λ¶νΉλ³„μμΉλ„ μ§„μ•κµ°", "μ „λ¶νΉλ³„μμΉλ„ λ¬΄μ£Όκµ°",
    "μ „λ¶νΉλ³„μμΉλ„ μ¥μκµ°", "μ „λ¶νΉλ³„μμΉλ„ μ„μ‹¤κµ°", "μ „λ¶νΉλ³„μμΉλ„ μμ°½κµ°", "μ „λ¶νΉλ³„μμΉλ„ κ³ μ°½κµ°", "μ „λ¶νΉλ³„μμΉλ„ λ¶€μ•κµ°",
    "μ „λΌλ‚¨λ„ λ©ν¬μ‹", "μ „λΌλ‚¨λ„ μ—¬μμ‹", "μ „λΌλ‚¨λ„ μμ²μ‹", "μ „λΌλ‚¨λ„ λ‚μ£Όμ‹", "μ „λΌλ‚¨λ„ κ΄‘μ–‘μ‹",
    "μ „λΌλ‚¨λ„ λ‹΄μ–‘κµ°", "μ „λΌλ‚¨λ„ κ³΅μ„±κµ°", "μ „λΌλ‚¨λ„ κµ¬λ΅€κµ°", "μ „λΌλ‚¨λ„ κ³ ν¥κµ°", "μ „λΌλ‚¨λ„ λ³΄μ„±κµ°",
    "μ „λΌλ‚¨λ„ ν™”μκµ°", "μ „λΌλ‚¨λ„ μ¥ν¥κµ°", "μ „λΌλ‚¨λ„ κ°•μ§„κµ°", "μ „λΌλ‚¨λ„ ν•΄λ‚¨κµ°", "μ „λΌλ‚¨λ„ μμ•”κµ°",
    "μ „λΌλ‚¨λ„ λ¬΄μ•κµ°", "μ „λΌλ‚¨λ„ ν•¨ν‰κµ°", "μ „λΌλ‚¨λ„ μκ΄‘κµ°", "μ „λΌλ‚¨λ„ μ¥μ„±κµ°", "μ „λΌλ‚¨λ„ μ™„λ„κµ°",
    "μ „λΌλ‚¨λ„ μ§„λ„κµ°", "μ „λΌλ‚¨λ„ μ‹ μ•κµ°", "κ²½μƒλ¶λ„ ν¬ν•­μ‹", "κ²½μƒλ¶λ„ κ²½μ£Όμ‹", "κ²½μƒλ¶λ„ κΉ€μ²μ‹",
    "κ²½μƒλ¶λ„ μ•λ™μ‹", "κ²½μƒλ¶λ„ κµ¬λ―Έμ‹", "κ²½μƒλ¶λ„ μμ£Όμ‹", "κ²½μƒλ¶λ„ μμ²μ‹", "κ²½μƒλ¶λ„ μƒμ£Όμ‹",
    "κ²½μƒλ¶λ„ λ¬Έκ²½μ‹", "κ²½μƒλ¶λ„ κ²½μ‚°μ‹", "κ²½μƒλ¶λ„ μμ„±κµ°", "κ²½μƒλ¶λ„ μ²­μ†΅κµ°", "κ²½μƒλ¶λ„ μμ–‘κµ°",
    "κ²½μƒλ¶λ„ μλ•κµ°", "κ²½μƒλ¶λ„ μ²­λ„κµ°", "κ²½μƒλ¶λ„ κ³ λ Ήκµ°", "κ²½μƒλ¶λ„ μ„±μ£Όκµ°", "κ²½μƒλ¶λ„ μΉ κ³΅κµ°",
    "κ²½μƒλ¶λ„ μμ²κµ°", "κ²½μƒλ¶λ„ λ΄‰ν™”κµ°", "κ²½μƒλ¶λ„ μΈμ§„κµ°", "κ²½μƒλ¶λ„ μΈλ¦‰κµ°", "κ²½μƒλ‚¨λ„ μ°½μ›μ‹",
    "κ²½μƒλ‚¨λ„ μ§„μ£Όμ‹", "κ²½μƒλ‚¨λ„ ν†µμμ‹", "κ²½μƒλ‚¨λ„ μ‚¬μ²μ‹", "κ²½μƒλ‚¨λ„ κΉ€ν•΄μ‹", "κ²½μƒλ‚¨λ„ λ°€μ–‘μ‹",
    "κ²½μƒλ‚¨λ„ κ±°μ μ‹", "κ²½μƒλ‚¨λ„ μ–‘μ‚°μ‹", "κ²½μƒλ‚¨λ„ μλ Ήκµ°", "κ²½μƒλ‚¨λ„ ν•¨μ•κµ°", "κ²½μƒλ‚¨λ„ μ°½λ…•κµ°",
    "κ²½μƒλ‚¨λ„ κ³ μ„±κµ°", "κ²½μƒλ‚¨λ„ λ‚¨ν•΄κµ°", "κ²½μƒλ‚¨λ„ ν•λ™κµ°", "κ²½μƒλ‚¨λ„ μ‚°μ²­κµ°", "κ²½μƒλ‚¨λ„ ν•¨μ–‘κµ°",
    "κ²½μƒλ‚¨λ„ κ±°μ°½κµ°", "κ²½μƒλ‚¨λ„ ν•©μ²κµ°"
]

# νƒ€κ² μ‹λ„ μ΄λ¦„
target_prefixes = [
    "λ€μ „κ΄‘μ—­μ‹", "μ„ΈμΆ…νΉλ³„μμΉμ‹", "κ²½κΈ°λ„", "κ°•μ›νΉλ³„μμΉλ„", "μΈμ‚°κ΄‘μ—­μ‹", "μ„μΈνΉλ³„μ‹",
    "κ²½μƒλ‚¨λ„", "λ€κµ¬κ΄‘μ—­μ‹", "λ¶€μ‚°κ΄‘μ—­μ‹", "μ μ£ΌνΉλ³„μμΉλ„", "κ΄‘μ£Όκ΄‘μ—­μ‹", "μΈμ²κ΄‘μ—­μ‹"
]

# β… Folium μ§€λ„ κ°μ²΄ μƒμ„±
m = folium.Map(location=[36.5000, 128.5000], zoom_start=7, tiles='cartodbpositron')

for _, row in gdf.iterrows():
    if row['sgg_nm'] in target_names:
        color = 'blue'
    elif any(row['sgg_nm'].startswith(prefix) for prefix in target_prefixes):
        color = 'green'
    else:
        color = 'gray'

    popup = Popup(row['sgg_nm'], parse_html=True)

    folium.GeoJson(
        row['geometry'],
        style_function=lambda x, color=color: {
            'fillColor': color,
            'color': 'black',
            'weight': 2,
            'fillOpacity': 0.6,
        },
        tooltip=folium.Tooltip(row['sgg_nm']),
    ).add_to(m)

# β… Streamlit UI μµμ ν™”
col1, col2 = st.columns(2, vertical_alignment="top")

with col1:
    st.markdown('π©μ‹λ„ μ§€μ—­ν™”ν&nbsp;&nbsp;π¦μ‹κµ°κµ¬ μ§€μ—­ν™”ν')
    st_folium(m, width=600, height=600)

with col2:
    embed_dashboard("https://tacademykr-dataanalysis.cloud.databricks.com/embed/dashboardsv3/01efcbf6fb8312e09dcfa6a57687aa13?o=2766527531974171",
                   height='650')

embed_dashboard("https://tacademykr-dataanalysis.cloud.databricks.com/embed/dashboardsv3/01efcc06ae7f168ea06c616214e9e790?o=2766527531974171",
               height='500')